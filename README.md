# AI Workflow Builder Template

> **Early Preview**: This is an early preview repository. Expect breaking changes and rough edges as we continue development.

A visual workflow automation platform built with **Inngest** for durable workflow execution and **TanStack Start** as the full-stack React framework.

This project was migrated from Next.js with Vercel's workflow package to Inngest and TanStack Start, demonstrating how to build a production-ready workflow builder with modern tooling.

![AI Workflow Builder Screenshot](screenshot.png)

## What's Included

- **Visual Workflow Builder** - Drag-and-drop interface powered by React Flow
- **Inngest Integration** - Durable workflow execution with automatic retries and observability
- **Real Integrations** - Connect to Resend (emails), Linear (tickets), Slack, PostgreSQL, and external APIs
- **Execution Tracking** - Monitor workflow runs with detailed logs
- **Authentication** - Secure user authentication with Better Auth
- **AI-Powered** - Generate workflows from natural language descriptions
- **Database** - PostgreSQL with Drizzle ORM for type-safe database access
- **Modern UI** - Beautiful shadcn/ui components with dark mode support

## Getting Started

### Prerequisites

- Node.js 18+
- PostgreSQL database
- pnpm package manager

### Database Setup

You'll need a PostgreSQL database. Some options:

- **PlanetScale** - $5/month PlanetScale Postgres (used in this example)
- **Supabase** - Free tier available
- **Neon** - Free tier available
- **Fly.io** - Free tier available
- **Local PostgreSQL** - Run your own

### Environment Variables

Create a `.env` file with the following:

```env
# Database
DATABASE_URL=postgresql://user:password....

# Better Auth - Generate with: openssl rand -hex 32
BETTER_AUTH_SECRET=your-generated-secret-here
BETTER_AUTH_URL=http://localhost:3000

# Integration Encryption Key - Generate with: openssl rand -hex 32
INTEGRATION_ENCRYPTION_KEY=your-generated-key-here

# AI Gateway (for AI workflow generation)
AI_GATEWAY_API_KEY=your-openai-api-key
```

**Generate your secrets:**

```bash
# Generate BETTER_AUTH_SECRET
openssl rand -hex 32

# Generate INTEGRATION_ENCRYPTION_KEY
openssl rand -hex 32
```

### Installation

```bash
# Install dependencies
pnpm install

# Run database migrations
pnpm db:push

# Start the Inngest dev server (in a separate terminal)
npx inngest-cli@latest dev

# Start development server
pnpm dev
```

### Inngest Setup

1. Start the Inngest dev server:

   ```bash
   npx inngest-cli@latest dev
   ```

2. Open the Inngest dev UI at [http://localhost:8288](http://localhost:8288)

3. Go to the **Apps** tab and click **Sync**

4. Enter your app URL: `http://localhost:3000/api/inngest`

5. Click **Sync** to register your functions

Now when you run workflows, they'll be executed by Inngest with full observability in the dev UI.

### Running the App

1. Visit [http://localhost:3000](http://localhost:3000)
2. Sign in (anonymous auth is enabled for development)
3. Create a workflow by adding trigger and action nodes
4. Configure each action node with an action type
5. Run your workflow and watch execution in real-time

## Workflow Types

### Trigger Nodes

- Webhook
- Schedule
- Manual
- Database Event

### Action Nodes

<!-- PLUGINS:START - Do not remove. Auto-generated by discover-plugins -->
- **AI Gateway**: Generate Text, Generate Image
- **Blob**: Put Blob, List Blobs
- **Clerk**: Get User, Create User, Update User, Delete User
- **fal.ai**: Generate Image, Generate Video, Upscale Image, Remove Background, Image to Image
- **Firecrawl**: Scrape URL, Search Web
- **GitHub**: Create Issue, List Issues, Get Issue, Update Issue
- **Linear**: Create Ticket, Find Issues
- **Perplexity**: Search Web, Ask Question, Research Topic
- **Resend**: Send Email
- **Slack**: Send Slack Message
- **Stripe**: Create Customer, Get Customer, Create Invoice
- **Superagent**: Guard, Redact
- **v0**: Create Chat, Send Message
- **Webflow**: List Sites, Get Site, Publish Site
<!-- PLUGINS:END -->

## Architecture

### How Inngest Works in This Project

1. **Workflow Execution Request** - Frontend calls `/api/workflow/{id}/execute`
2. **Event Sent to Inngest** - The API sends a `workflow/execute` event via `inngest.send()`
3. **Inngest Executes Function** - The `workflow-executor` function runs with durable step execution
4. **Each Node = step.run()** - Each workflow node is wrapped in `step.run()` for automatic retries
5. **Status Updates** - Execution status is written to the database as nodes complete
6. **Frontend Polls** - The UI polls for status updates and shows real-time progress

### Key Files

- `src/lib/inngest/client.ts` - Inngest client configuration
- `src/lib/inngest/functions/workflow-executor.ts` - Main workflow execution function
- `src/routes/api/inngest.ts` - Inngest API route handler
- `src/routes/api/workflow.$workflowId.execute.ts` - Workflow execution endpoint

## API Endpoints

### Workflow Management

- `GET /api/workflows` - List all workflows
- `POST /api/workflows` - Create a new workflow
- `GET /api/workflows/{id}` - Get workflow by ID
- `PUT /api/workflows/{id}` - Update workflow
- `DELETE /api/workflows/{id}` - Delete workflow

### Workflow Execution

- `POST /api/workflow/{id}/execute` - Execute a workflow
- `GET /api/workflows/{id}/executions` - Get execution history
- `GET /api/workflows/executions/{executionId}/logs` - Get detailed execution logs
- `GET /api/workflows/executions/{executionId}/status` - Get execution status

### Inngest

- `GET/POST/PUT /api/inngest` - Inngest webhook handler

## Database Schema

### Tables

- `user` - User accounts
- `session` - User sessions
- `workflows` - Workflow definitions
- `workflow_executions` - Execution history
- `workflow_execution_logs` - Detailed node execution logs
- `integrations` - Encrypted integration credentials

## Development

### Scripts

```bash
# Development
pnpm dev

# Build
pnpm build

# Type checking
pnpm type-check

# Linting and formatting
pnpm fix

# Database
pnpm db:generate  # Generate migrations
pnpm db:push      # Push schema to database
pnpm db:studio    # Open Drizzle Studio

# Plugins
pnpm discover-plugins  # Regenerate plugin registry
pnpm create-plugin     # Create a new plugin
```

## Tech Stack

- **Framework**: TanStack Start with React 19
- **Workflow Engine**: Inngest
- **UI**: shadcn/ui with Tailwind CSS
- **State Management**: Jotai
- **Database**: PostgreSQL with Drizzle ORM
- **Authentication**: Better Auth
- **Code Editor**: Monaco Editor
- **Workflow Canvas**: React Flow
- **Type Checking**: TypeScript
- **Code Quality**: Ultracite (formatter + linter)

## License

Apache 2.0
